{% extends "base.html" %}
{% load static %}

{% block title %}{{ module.title }} - {{ module.course.title }} | ProHacker Academy{% endblock %}

{% block extra_head %}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css">
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css"
      crossorigin="anonymous">

      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false}
        ]});"></script>

        
{% endblock %}

{% block content %}

<!-- Alpine.js (required) -->
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

<div x-data="{ sidebarOpen: false }" class="flex lg:hidden">

    <!-- ðŸŒŸ MOBILE TOGGLE BUTTON -->
    <button 
        @click="sidebarOpen = !sidebarOpen"
        class="lg:hidden fixed bottom-6 right-6 z-50 p-4 bg-indigo-600 text-white rounded-full shadow-md hover:bg-indigo-700 active:scale-95 transition"
    >
        <!-- Hamburger Icon -->
        <svg x-show="!sidebarOpen" class="w-6 h-6" fill="none" 
             stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M4 6h16M4 12h16M4 18h16"/>
        </svg>

        <!-- Close Icon -->
        <svg x-show="sidebarOpen" class="w-6 h-6" fill="none" 
             stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M6 18L18 6M6 6l12 12"/>
        </svg>
    </button>


    <!-- ðŸŒŸ OVERLAY (Mobile only) -->
    <div 
        x-show="sidebarOpen"
        @click="sidebarOpen = false"
        class="fixed inset-0 bg-black/40 z-40 lg:hidden"
        x-transition.opacity
    ></div>


    <!-- ðŸŒŸ SIDEBAR -->
    <aside 
        class="fixed inset-y-0 left-0 z-50 w-72 bg-white dark:bg-gray-900 shadow-xl
               transform transition-transform duration-300 ease-in-out
               lg:relative lg:translate-x-0 lg:shadow-none"
        :class="{ 'translate-x-0': sidebarOpen, '-translate-x-full': !sidebarOpen }"
    >

        <div class="p-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
          <h3 class="text-sm font-bold text-gray-900 dark:text-cyan-400 mb-3">MODULES</h3>

          <!-- Search Bar -->
          <div class="relative">
            <input 
              type="text" 
              id="module-search" 
              placeholder="Search modules..." 
              class="w-full pl-9 pr-3 py-2 text-sm rounded-md border border-gray-300 dark:border-gray-600 
                    bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 
                    focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent
                    transition-all"
            >
            <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" 
                fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </div>
        </div>

        <!-- Modules List -->
        <div class="h-screen overflow-y-auto">
          {% for mod in module.course.modules.all %}
            {% with progress=mod.user_progress|default:0 %}
            <a href="{% url 'courses:module_detail' module.course.slug mod.id %}"
              class="module-item block p-3 border-b border-gray-200 dark:border-gray-700 text-sm 
                      hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors
                      {% if mod.id == module.id %}bg-indigo-50 dark:bg-gray-700 text-indigo-700 dark:text-cyan-300 font-medium{% else %}text-gray-700 dark:text-gray-300{% endif %}">
              <div class="flex justify-between items-center">
                <span class="module-title truncate">{{ mod.title|truncatechars:30 }}</span>
                {% if mod.id == module.id %}
                  <span class="text-xs text-indigo-600 dark:text-cyan-400 flex-shrink-0 ml-2">Play</span>
                {% endif %}
              </div>
              {% if progress > 0 %}
                <div class="mt-1 w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1">
                  <div class="bg-gradient-to-r from-indigo-500 to-emerald-500 h-1 rounded-full transition-all duration-500"
                      ></div>
                </div>
                <span class="text-xs text-gray-500 dark:text-gray-400">{{ progress }}%</span>
              {% endif %}
            </a>
            {% endwith %}
          {% endfor %}
        </div>
    </aside>


    <!-- ðŸŒŸ PAGE CONTENT -->
    <main class="flex-1 p-6">
        <!-- Module Header -->
        <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-5">
          <h1 class="text-2xl font-bold text-indigo-700 dark:text-purple-400">{{ module.title }}</h1>
          {% if module.description %}
            <p class="mt-3 text-base text-gray-600 dark:text-gray-300 leading-relaxed">{{ module.description }}</p>
          {% endif %}
        </div>


        <!-- Content Block -->
      {% if content %}
        <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden">

          <!-- Header -->
          <div class="p-4 border-b border-gray-200 dark:border-gray-700">
            <h2 class="text-lg font-semibold text-emerald-600 dark:text-green-400">{{ content.main_title }}</h2>
            {% if content.title %}
              <p class="text-base text-gray-600 dark:text-gray-400 mt-1">{{ content.title }}</p>
            {% endif %}
          </div>

          <!-- Body -->
          <div class="p-6 text-base text-gray-700 dark:text-gray-300 leading-relaxed space-y-6">

           
            {% if content_html %}
              <div class="prose prose-base prose-indigo dark:prose-invert w-sm">
               
                {{ content_html | safe }}
              </div>
            {% endif %}


            <!-- Description / Note -->
            {% if content.description %}
              <div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-300 dark:border-yellow-700 rounded text-base text-yellow-800 dark:text-yellow-300">
                <strong class="text-yellow-900 dark:text-yellow-400">Note:</strong> {{ content.description }}
              </div>
            {% endif %}
          </div>

          <!-- Footer: Prev/Next + Updated -->
          <div class="p-3 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400 flex justify-between items-center">
            <span>Last updated: {{ content.updated_at|date:"M d, Y" }}</span>
            <div class="flex gap-4">
              {% if prev_module %}
                <a href="{% url 'courses:module_detail' module.course.slug prev_module.id %}" class="text-indigo-600 dark:text-cyan-400 hover:underline">
                  Previous
                </a>
              {% endif %}
              {% if next_module %}
                <a href="{% url 'courses:module_detail' module.course.slug next_module.id %}" class="text-indigo-600 dark:text-cyan-400 hover:underline">
                  Next
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      {% else %}
        <div class="text-center py-12 bg-white dark:bg-gray-800 rounded-lg border border-red-200 dark:border-red-900">
          <p class="text-red-600 dark:text-red-400 text-lg font-medium">No content available</p>
          <p class="text-gray-600 dark:text-gray-400 text-base mt-1">This module is under construction.</p>
        </div>
      {% endif %}

    </main>

</div>



<!-- Your existing scripts (KaTeX, copy code, search, etc.) stay exactly the same -->
<script>
  // Your existing module search script
  document.addEventListener('DOMContentLoaded', function () {
    const searchInput = document.getElementById('module-search');
    const moduleItems = document.querySelectorAll('.module-item');
    const moduleTitles = document.querySelectorAll('.module-title');

    searchInput.addEventListener('input', function () {
      const query = searchInput.value.trim().toLowerCase();
      moduleItems.forEach((item, index) => {
        const title = moduleTitles[index].textContent.toLowerCase();
        item.style.display = title.includes(query) ? '' : 'none';
      });
    });

    searchInput.addEventListener('search', function () {
      if (!this.value) moduleItems.forEach(item => item.style.display = '');
    });
  });
</script>


<main class="hidden lg:block xl:block ">
  <!-- Breadcrumb -->
<nav class="sticky top-18 left-0 w-full z-50 bg-white z-40 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-4 py-3 mb-6 text-sm text-gray-500 dark:text-gray-400 backdrop-blur-sm bg-opacity-90">
  <div class="max-w-7xl mx-auto flex items-center gap-2 flex-wrap">
    <a href="{% url 'courses:courses_list' %}" class="text-indigo-600 dark:text-cyan-400 hover:underline">Courses</a>
    <span>></span>
    <a href="{% url 'courses:course_detail' module.course.slug %}" class="text-indigo-600 dark:text-cyan-300 hover:underline truncate max-w-xs">
      {{ module.course.title|truncatechars:25 }}
    </a>
    <span>></span>
    <span class="text-gray-700 dark:text-gray-300 truncate max-w-xs">{{ module.title|truncatechars:25 }}</span>
  </div>
</nav>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
  <div class="grid lg:grid-cols-12 gap-6">



    <aside class="lg:col-span-3">
      <div class="sticky top-28 z-30 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
        <!-- Header with Title and Search -->
        <div class="p-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
          <h3 class="text-sm font-bold text-gray-900 dark:text-cyan-400 mb-3">MODULES</h3>

          <!-- Search Bar -->
          <div class="relative">
            <input 
              type="text" 
              id="module-search" 
              placeholder="Search modules..." 
              class="w-full pl-9 pr-3 py-2 text-sm rounded-md border border-gray-300 dark:border-gray-600 
                    bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 
                    focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent
                    transition-all"
            >
            <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" 
                fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </div>
        </div>

        <!-- Modules List -->
        <div class="max-h-[calc(100vh-180px)] overflow-y-auto">
          {% for mod in module.course.modules.all %}
            {% with progress=mod.user_progress|default:0 %}
            <a href="{% url 'courses:module_detail' module.course.slug mod.id %}"
              class="module-item block p-3 border-b border-gray-200 dark:border-gray-700 text-sm 
                      hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors
                      {% if mod.id == module.id %}bg-indigo-50 dark:bg-gray-700 text-indigo-700 dark:text-cyan-300 font-medium{% else %}text-gray-700 dark:text-gray-300{% endif %}">
              <div class="flex justify-between items-center">
                <span class="module-title truncate">{{ mod.title|truncatechars:30 }}</span>
                {% if mod.id == module.id %}
                  <span class="text-xs text-indigo-600 dark:text-cyan-400 flex-shrink-0 ml-2">Play</span>
                {% endif %}
              </div>
              {% if progress > 0 %}
                <div class="mt-1 w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1">
                  <div class="bg-gradient-to-r from-indigo-500 to-emerald-500 h-1 rounded-full transition-all duration-500"
                      ></div>
                </div>
                <span class="text-xs text-gray-500 dark:text-gray-400">{{ progress }}%</span>
              {% endif %}
            </a>
            {% endwith %}
          {% endfor %}
        </div>
      </div>
    </aside>

    <!-- JavaScript for Live Search -->
    <script>
    document.addEventListener('DOMContentLoaded', function () {
      const searchInput = document.getElementById('module-search');
      const moduleItems = document.querySelectorAll('.module-item');
      const moduleTitles = document.querySelectorAll('.module-title');

      searchInput.addEventListener('input', function () {
        const query = searchInput.value.trim().toLowerCase();

        moduleItems.forEach((item, index) => {
          const title = moduleTitles[index].textContent.toLowerCase();
          if (title.includes(query)) {
            item.style.display = '';
          } else {
            item.style.display = 'none';
          }
        });
      });

      // Optional: Clear search when clicking the "X" (native clear button in some browsers) or pressing Escape
      searchInput.addEventListener('search', function () {
        if (!this.value) {
          moduleItems.forEach(item => item.style.display = '');
        }
      });
    });
    </script>



    <!-- Main Content -->
    <main class="lg:col-span-9 space-y-6">

      <!-- Module Header -->
      <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-5">
        <h1 class="text-2xl font-bold text-indigo-700 dark:text-purple-400">{{ module.title }}</h1>
        {% if module.description %}
          <p class="mt-3 text-base text-gray-600 dark:text-gray-300 leading-relaxed">{{ module.description }}</p>
        {% endif %}
      </div>

      <!-- Content Block -->
      {% if content %}
        <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden">

          <!-- Header -->
          <div class="p-4 border-b border-gray-200 dark:border-gray-700">
            <h2 class="text-lg font-semibold text-emerald-600 dark:text-green-400">{{ content.main_title }}</h2>
            {% if content.title %}
              <p class="text-base text-gray-600 dark:text-gray-400 mt-1">{{ content.title }}</p>
            {% endif %}
          </div>

          <!-- Body -->
           
          <div class="p-6 text-base text-gray-700 dark:text-gray-300 leading-relaxed space-y-6">

           
            {% if content_html %}
              <div class="prose prose-base prose-indigo dark:prose-invert max-w-none">
               
                {{ content_html | safe }}
              </div>
            {% endif %}

            <!-- Code Block with Copy Button -->
            {% if content.code %}
              <div class="mt-6">
                <div class="flex justify-between items-center mb-2">
                  <span class="text-xs font-medium text-indigo-600 dark:text-cyan-400">
                    CODE ({{ content.get_code_language_display }})
                  </span>
                  <button onclick="copyCode(this, `{{ content.code|escapejs }}`)" 
                          class="copy-btn text-xs px-3 py-1 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-gray-700 dark:text-cyan-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition">
                    COPY
                  </button>
                </div>
                <pre class="overflow-x-auto rounded border border-gray-200 dark:border-gray-700"><code class="language-{{ content.code_language }} block p-4 bg-gray-50 dark:bg-gray-900 text-sm">{{ content.code }}</code></pre>
              </div>
            {% endif %}

            <!-- Description / Note -->
            {% if content.description %}
              <div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-300 dark:border-yellow-700 rounded text-base text-yellow-800 dark:text-yellow-300">
                <strong class="text-yellow-900 dark:text-yellow-400">Note:</strong> {{ content.description }}
              </div>
            {% endif %}
          </div>

          <!-- Footer: Prev/Next + Updated -->
          <div class="p-3 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400 flex justify-between items-center">
            <span>Last updated: {{ content.updated_at|date:"M d, Y" }}</span>
            <div class="flex gap-4">
              {% if prev_module %}
                <a href="{% url 'courses:module_detail' module.course.slug prev_module.id %}" class="text-indigo-600 dark:text-cyan-400 hover:underline">
                  Previous
                </a>
              {% endif %}
              {% if next_module %}
                <a href="{% url 'courses:module_detail' module.course.slug next_module.id %}" class="text-indigo-600 dark:text-cyan-400 hover:underline">
                  Next
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      {% else %}
        <div class="text-center py-12 bg-white dark:bg-gray-800 rounded-lg border border-red-200 dark:border-red-900">
          <p class="text-red-600 dark:text-red-400 text-lg font-medium">No content available</p>
          <p class="text-gray-600 dark:text-gray-400 text-base mt-1">This module is under construction.</p>
        </div>
      {% endif %}

    </main>
  </div>
</div>

</main>


<!-- KaTeX: Auto-render math -->
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.querySelector('.mdx-content'), {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "$", right: "$", display: false},
                {left: "\\[", right: "\\]", display: true},
                {left: "\\(", right: "\\)", display: false}
            ],
            throwOnError: false
        });
    });
</script>
<style>
  .markdown-content { line-height:1.8; font-size:1.1rem; }
  .katex-display { margin:1.5rem 0; }
</style>


<!-- Copy to Clipboard Script -->
<script>
function copyCode(btn, code) {
  navigator.clipboard.writeText(code).then(() => {
    const original = btn.textContent;
    btn.textContent = 'COPIED!';
    btn.classList.add('bg-green-600', 'text-white');
    setTimeout(() => {
      btn.textContent = original;
      btn.classList.remove('bg-green-600', 'text-white');
    }, 2000);
  }).catch(() => {
    alert('Failed to copy');
  });
}
</script>

{% endblock %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body);"></script>
{% block extra_css %}
<style>

  .card-hover {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .card-hover:hover {
    transform: translateY(-4px);
  }
  .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
  .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
</style>
{% endblock %}